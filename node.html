<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nh·∫≠n L√¨ X√¨</title>
  <style>
    /* C√°c ki·ªÉu CSS gi·ªØ nguy√™n t·ª´ y√™u c·∫ßu c·ªßa b·∫°n */

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(145deg, #fffae3, #ffe4c1);
      text-align: center;
      padding: 20px;
      overflow: hidden;
      animation: backgroundShift 10s infinite alternate;
    }

    /* C√°c l·ªõp CSS cho ho·∫°t ·∫£nh, hi·ªáu ·ª©ng n√∫t, v√† ph·∫ßn giao di·ªán */

    @keyframes backgroundShift {
      0% { background: linear-gradient(145deg, #fffae3, #ffe4c1); }
      100% { background: linear-gradient(145deg, #ffd5a8, #fffae3); }
    }

    /* C√°c ph·∫ßn giao di·ªán ch√≠nh, n√∫t, th√¥ng b√°o ... */

    .message {
      margin-top: 30px;
      font-size: 1.4em;
      font-weight: bold;
      color: #4a4e69;
      display: none;
      animation: messageAppear 1.5s forwards;
    }

    /* Ki·ªÉu ch·ªØ cho key input, button, v√† th√¥ng b√°o */

    .key-input, .message {
      font-family: 'Courier New', monospace;
      letter-spacing: 2px;
      font-weight: bold; /* In ƒë·∫≠m to√†n b·ªô ch·ªØ */
    }

    /* C√°c ki·ªÉu m·ªõi cho b·∫£ng s·∫øp h·∫°ng */

    .ranking {
      margin-top: 50px;
      padding: 20px;
      background-color: #fff;
      border-radius: 10px;
      border: 2px solid #ffba08;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    }

    .ranking-table {
      width: 100%;
      border-collapse: collapse;
    }

    .ranking-table th, .ranking-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .ranking-table th {
      background-color: #ffba08;
      color: white;
    }

  </style>
</head>
<body>

  <div class="lixi-container">
    <div class="key-input-container">
      <input type="text" class="key-input" id="keyInput" placeholder="Nh·∫≠p M√£ ƒêi P√©">
    </div>
    <button class="key-submit" onclick="validateKey()">M·ªü L√¨ X√¨ ‚ùÑ</button>
    <div class="message" id="message"></div>
    <button class="btn-refresh" id="refresh" onclick="refreshPage()">L·∫•y L√¨ X√¨</button>
    <div id="fireworks-container"></div>
  </div>

  <!-- B·∫£ng x·∫øp h·∫°ng -->
  <div class="ranking">
    <h3>B·∫£ng S·∫øp H·∫°ng L√¨ X√¨</h3>
    <table class="ranking-table" id="rankingTable">
      <thead>
        <tr>
          <th>Th·ª© t·ª±</th>
          <th>Gmail</th>
          <th>S·ªë ti·ªÅn</th>
        </tr>
      </thead>
      <tbody>
        <!-- D·ªØ li·ªáu b·∫£ng x·∫øp h·∫°ng s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn ·ªü ƒë√¢y -->
      </tbody>
    </table>
  </div>

  <script>
    let hasOpened = false;
    let ipAddress = null;
    let availableKeys = {}; // ƒê·ªÉ l∆∞u tr·ªØ c√°c key v√† s·ªë l∆∞·ª£ng l∆∞·ª£t s·ª≠ d·ª•ng
    let usersOpened = []; // L∆∞u tr·ªØ ng∆∞·ªùi d√πng ƒë√£ m·ªü l√¨ x√¨ (email, ti·ªÅn, v.v.)

    // L·∫•y danh s√°ch key t·ª´ file
    fetch("key.txt")
      .then(response => response.text())
      .then(data => {
        const keys = data.split("\n");
        keys.forEach(key => {
          const [keyValue, quantity] = key.split(":");
          availableKeys[keyValue] = parseInt(quantity);
        });
      });

    function createFirework() {
      const firework = document.createElement("div");
      firework.classList.add("firework");
      firework.style.left = Math.random() * 100 + "%";
      firework.style.top = Math.random() * 100 + "%";
      document.getElementById("fireworks-container").appendChild(firework);

      setTimeout(() => firework.remove(), 1000);
    }

    function launchFireworks() {
      setInterval(createFirework, 200);
    }

    function validateKey() {
      const key = document.getElementById("keyInput").value;
      const email = "user@example.com"; // Gi·∫£ s·ª≠ email l·∫•y t·ª´ input ho·∫∑c t√†i kho·∫£n ƒë√£ ƒëƒÉng nh·∫≠p

      if (hasOpened) {
        alert("B·∫°n ƒë√£ m·ªü l√¨ x√¨ r·ªìi, ch·ªâ m·ªôt l·∫ßn duy nh·∫•t!");
        return;
      }

      if (key && availableKeys[key] > 0) {
        const min = 1000;
        const max = 20000;
        const amount = Math.floor(Math.random() * (max - min + 1)) + min;

        const messageDiv = document.getElementById("message");
        const refreshButton = document.getElementById("refresh");

        messageDiv.style.display = "block";
        refreshButton.style.display = "inline-block";
        messageDiv.innerHTML = `üéâ Ch√∫c m·ª´ng! Tr√∫ng L√¨ X√¨ <strong style="color: #d62828;">${amount.toLocaleString()}ƒë</strong>!`;

        document.getElementById("keyInput").style.display = "none";  
        document.querySelector(".key-submit").style.display = "none";

        hasOpened = true;

        // Gi·∫£m l∆∞·ª£t s·ª≠ d·ª•ng c·ªßa key v√† l∆∞u l·∫°i
        availableKeys[key] -= 1;
        if (availableKeys[key] === 0) {
          delete availableKeys[key];
        }
        updateKeyFile();

        // L∆∞u th√¥ng tin ng∆∞·ªùi d√πng m·ªü l√¨ x√¨
        saveUserData(email, amount);

        launchFireworks();
      } else {
        alert("M√£ Kh√¥ng ƒê√∫ng! Vui L√≤ng Nh·∫Øn Tin ƒê·ªÉ L·∫•y M√£");
      }
    }

    function updateKeyFile() {
      const keyFileContent = Object.entries(availableKeys)
        .map(([key, quantity]) => `${key}:${quantity}`)
        .join("\n");

      // G·ª≠i n·ªôi dung v·ªÅ server (m√¥ ph·ªèng)
      console.log(keyFileContent); 
    }

    function saveUserData(email, amount) {
      // Ki·ªÉm tra v√† l∆∞u tr·ªØ th√¥ng tin ng∆∞·ªùi d√πng v√†o localStorage
      const userData = {
        email: email,
        amount: amount,
        timestamp: new Date().toISOString()
      };
      
      let existingData = JSON.parse(localStorage.getItem("usersOpened") || "[]");
      existingData.push(userData);
      localStorage.setItem("usersOpened", JSON.stringify(existingData));

      updateRankingTable();
    }

    function updateRankingTable() {
      // L·∫•y d·ªØ li·ªáu b·∫£ng x·∫øp h·∫°ng t·ª´ localStorage
      const usersOpened = JSON.parse(localStorage.getItem("usersOpened") || "[]");

      // C·∫≠p nh·∫≠t b·∫£ng x·∫øp h·∫°ng
      const rankingTable = document.getElementById("rankingTable").getElementsByTagName("tbody")[0];
      rankingTable.innerHTML = ""; // X√≥a n·ªôi dung c≈©

      // S·∫Øp x·∫øp theo s·ªë ti·ªÅn
      usersOpened.sort((a, b) => b.amount - a.amount);

      usersOpened.slice(0, 10).forEach((user, index) => {
        const row = rankingTable.insertRow();
        row.insertCell(0).innerText = index + 1;
        row.insertCell(1).innerText = user.email.replace(/(.{3}).*(@.*)/, '$1***$2'); // ·∫®n 3 k√Ω t·ª± cu·ªëi
        row.insertCell(2).innerText = user.amount.toLocaleString() + 'ƒë';
      });
    }

    function refreshPage() {
      window.location.reload();
    }

    // Kh·ªüi t·∫°o b·∫£ng x·∫øp h·∫°ng khi trang ƒë∆∞·ª£c t·∫£i
    window.onload = function() {
      updateRankingTable();
    };
  </script>
</body>
</html>
